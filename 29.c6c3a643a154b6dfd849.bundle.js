(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1033:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react=__webpack_require__(1),react_default=__webpack_require__.n(react),prop_types=__webpack_require__(0),prop_types_default=__webpack_require__.n(prop_types),esm=__webpack_require__(781),immutable=__webpack_require__(766),immutable_default=__webpack_require__.n(immutable),web_mercator_viewport=__webpack_require__(1560);function roundDecimal(a,b){var d=b;return b?Math.round(a*(d=Math.pow(10,d)))/d:Math.round(a)}var EARTH_CIRCUMFERENCE_KM=40075.16;function kmToPixels(a,b,c){var d=b*(Math.PI/180);return roundDecimal(a/(EARTH_CIRCUMFERENCE_KM*Math.cos(d)/Math.pow(2,c+9)),2)}var LUMINANCE_RED_WEIGHT=.2126,LUMINANCE_GREEN_WEIGHT=.7152,LUMINANCE_BLUE_WEIGHT=.0722;__webpack_require__(831);var propTypes={aggregation:prop_types_default.a.string,compositeOperation:prop_types_default.a.string,dotRadius:prop_types_default.a.number,lngLatAccessor:prop_types_default.a.func,locations:prop_types_default.a.instanceOf(immutable_default.a.List).isRequired,pointRadiusUnit:prop_types_default.a.string,renderWhileDragging:prop_types_default.a.bool,rgb:prop_types_default.a.arrayOf(prop_types_default.a.oneOfType([prop_types_default.a.string,prop_types_default.a.number])),zoom:prop_types_default.a.number},ScatterPlotGlowOverlay=function(a){function b(b){var c;return(c=a.call(this,b)||this).redraw=c.redraw.bind(function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(c)),c}!function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}(b,a);var c=b.prototype;return c.drawText=function drawText(a,b,c){void 0===c&&(c={});var e=c,f=e.fontHeight,g=void 0===f?0:f,h=e.label,i=void 0===h?"":h,j=e.radius,k=void 0===j?0:j,l=e.rgb,m=void 0===l?[0,0,0]:l,n=e.shadow,o=1.8*k,p=function luminanceFromRGB(a,c,d){return LUMINANCE_RED_WEIGHT*a+LUMINANCE_GREEN_WEIGHT*c+LUMINANCE_BLUE_WEIGHT*d}(m[1],m[2],m[3]);a.globalCompositeOperation="source-over",a.fillStyle=p<=110?"white":"black",a.font=g+"px sans-serif",a.textAlign="center",a.textBaseline="middle",void 0!==n&&n&&(a.shadowBlur=15,a.shadowColor=p<=110?"black":"");var q=a.measureText(i).width;q>o&&(a.font=g/q*o+"px sans-serif");var r=this.props.compositeOperation;a.fillText(i,b[0],b[1]),a.globalCompositeOperation=r,a.shadowBlur=0,a.shadowColor=""},c.redraw=function redraw(a){var b=a.width,c=a.height,d=a.ctx,e=a.isDragging,f=a.project,g=this.props,h=g.aggregation,i=g.compositeOperation,j=g.dotRadius,k=g.lngLatAccessor,l=g.locations,m=g.pointRadiusUnit,n=g.renderWhileDragging,o=g.rgb,p=g.zoom,q=j,r=[];l.forEach(function(a,b){a.get("properties").get("cluster")&&(r[b]=function(a,b){var c=a.get("point_count");if(!b)return c;if("sum"===b||"min"===b||"max"===b)return a.get(b);var d=a.get("sum");if("mean"===b)return Math.round(d/c*100)/100;var f=a.get("squaredSum")/c-Math.pow(d/c,2);return"var"===b?Math.round(100*f)/100:"stdev"===b?Math.round(100*Math.sqrt(f))/100:c}(a.get("properties"),h))},this);var s=Math.max.apply(Math,r.filter(function(a){return!Number.isNaN(a)}));d.clearRect(0,0,b,c),d.globalCompositeOperation=i,(n||!e)&&l&&l.forEach(function(a,e){var g=f(k(a)),h=[roundDecimal(g[0],1),roundDecimal(g[1],1)];if(0<=h[0]+q&&h[0]-q<b&&0<=h[1]+q&&h[1]-q<c)if(d.beginPath(),a.get("properties").get("cluster")){var i=r[e],j=roundDecimal(Math.pow(i/s,.5)*q,1),l=roundDecimal(.5*j,1),n=h[0],t=h[1],u=d.createRadialGradient(n,t,j,n,t,0);u.addColorStop(1,"rgba("+o[1]+", "+o[2]+", "+o[3]+", 0.8)"),u.addColorStop(0,"rgba("+o[1]+", "+o[2]+", "+o[3]+", 0)"),d.arc(h[0],h[1],j,0,2*Math.PI),d.fillStyle=u,d.fill(),Number.isFinite(parseFloat(i))&&(1e4<=i?i=Math.round(i/1e3)+"k":1e3<=i&&(i=Math.round(i/100)/10+"k"),this.drawText(d,h,{fontHeight:l,label:i,radius:j,rgb:o,shadow:!0}))}else{var v,w=q/6,x=a.get("properties").get("radius"),y=a.get("properties").get("metric"),z=null===x?w:x;if(null!==x){var A=k(a)[1];"Kilometers"===m?(v=roundDecimal(z,2)+"km",z=kmToPixels(z,A,p)):"Miles"===m&&(v=roundDecimal(z,2)+"mi",z=kmToPixels(1.60934*z,A,p))}null!==y&&(v=Number.isFinite(parseFloat(y))?roundDecimal(y,2):y),z||(z=w),d.arc(h[0],h[1],roundDecimal(z,1),0,2*Math.PI),d.fillStyle="rgb("+o[1]+", "+o[2]+", "+o[3]+")",d.fill(),void 0!==v&&this.drawText(d,h,{fontHeight:roundDecimal(z,1),label:v,radius:z,rgb:o,shadow:!1})}},this)},c.render=function render(){return react_default.a.createElement(esm.a,{redraw:this.redraw})},b}(react_default.a.PureComponent);ScatterPlotGlowOverlay.propTypes=propTypes,ScatterPlotGlowOverlay.defaultProps={compositeOperation:"source-over",dotRadius:4,lngLatAccessor:function lngLatAccessor(a){return[a.get(0),a.get(1)]},renderWhileDragging:!0};var esm_ScatterPlotGlowOverlay=ScatterPlotGlowOverlay;__webpack_require__(790);function _extends(){return(_extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c])Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a}).apply(this,arguments)}__webpack_require__.d(__webpack_exports__,"DEFAULT_MAX_ZOOM",function(){return DEFAULT_MAX_ZOOM}),__webpack_require__.d(__webpack_exports__,"DEFAULT_POINT_RADIUS",function(){return DEFAULT_POINT_RADIUS});var DEFAULT_MAX_ZOOM=16,DEFAULT_POINT_RADIUS=60,MapBox_propTypes={width:prop_types_default.a.number,height:prop_types_default.a.number,aggregatorName:prop_types_default.a.string,clusterer:prop_types_default.a.object,globalOpacity:prop_types_default.a.number,hasCustomMetric:prop_types_default.a.bool,mapStyle:prop_types_default.a.string,mapboxApiKey:prop_types_default.a.string.isRequired,onViewportChange:prop_types_default.a.func,pointRadius:prop_types_default.a.number,pointRadiusUnit:prop_types_default.a.string,renderWhileDragging:prop_types_default.a.bool,rgb:prop_types_default.a.array,bounds:prop_types_default.a.array},MapBox_defaultProps={width:400,height:400,globalOpacity:1,onViewportChange:function(){},pointRadius:DEFAULT_POINT_RADIUS,pointRadiusUnit:"Pixels"},MapBox_MapBox=function(a){function b(b){var c=a.call(this,b)||this,d=c.props,e=d.width,f=d.height,g=d.bounds,h=new web_mercator_viewport.a({width:e,height:f}).fitBounds(g),i=h.latitude,j=h.longitude,k=h.zoom;return c.state={viewport:{longitude:j,latitude:i,zoom:k}},c.handleViewportChange=c.handleViewportChange.bind(function MapBox_assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(c)),c}!function MapBox_inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}(b,a);var c=b.prototype;return c.handleViewportChange=function handleViewportChange(a){this.setState({viewport:a}),(0,this.props.onViewportChange)(a)},c.render=function render(){var a=this.props,b=a.width,c=a.height,d=a.aggregatorName,e=a.clusterer,f=a.globalOpacity,g=a.mapStyle,h=a.mapboxApiKey,i=a.pointRadius,j=a.pointRadiusUnit,k=a.renderWhileDragging,l=a.rgb,m=a.hasCustomMetric,n=a.bounds,o=this.state.viewport,p=void 0!==o.isDragging&&o.isDragging,q=[n[0][0],n[0][1],n[1][0],n[1][1]],r=e.getClusters(q,Math.round(o.zoom));return react_default.a.createElement(esm.b,_extends({},o,{mapStyle:g,width:b,height:c,mapboxApiAccessToken:h,onViewportChange:this.handleViewportChange}),react_default.a.createElement(esm_ScatterPlotGlowOverlay,_extends({},o,{isDragging:p,locations:immutable_default.a.fromJS(r),dotRadius:i,pointRadiusUnit:j,rgb:l,globalOpacity:f,compositeOperation:"screen",renderWhileDragging:k,aggregation:m?d:null,lngLatAccessor:function lngLatAccessor(a){var b=a.get("geometry").get("coordinates");return[b.get(0),b.get(1)]}})))},b}(react_default.a.Component);MapBox_MapBox.propTypes=MapBox_propTypes,MapBox_MapBox.defaultProps=MapBox_defaultProps;__webpack_exports__.default=MapBox_MapBox},790:function(module,exports,__webpack_require__){var content=__webpack_require__(791);"string"==typeof content&&(content=[[module.i,content,""]]);var options={hmr:!0,transform:void 0,insertInto:void 0};__webpack_require__(142)(content,options);content.locals&&(module.exports=content.locals)},791:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(141)(!1)).push([module.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.mapbox .slice_container div {\n  padding-top: 0px;\n}\n',""])}}]);
//# sourceMappingURL=29.c6c3a643a154b6dfd849.bundle.js.map