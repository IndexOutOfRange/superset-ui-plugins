(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1047:function(module,exports,__webpack_require__){var content=__webpack_require__(1048);"string"==typeof content&&(content=[[module.i,content,""]]);var options={hmr:!0,transform:void 0,insertInto:void 0};__webpack_require__(147)(content,options);content.locals&&(module.exports=content.locals)},1048:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(146)(!1)).push([module.i,'/* [LICENSE TBD] */\n/* Cal-HeatMap CSS */\n\n.cal-heatmap-container {\n  display: block;\n}\n\n.cal-heatmap-container .graph-label\n{\n  fill: #999;\n  font-size: 10px\n}\n\n.cal-heatmap-container .graph, .cal-heatmap-container .graph-legend rect {\n  shape-rendering: crispedges\n}\n\n.cal-heatmap-container .graph-rect\n{\n  fill: #ededed\n}\n\n.cal-heatmap-container .graph-subdomain-group rect:hover\n{\n  stroke: #000;\n  stroke-width: 1px\n}\n\n.cal-heatmap-container .subdomain-text {\n  font-size: 8px;\n  fill: #999;\n  pointer-events: none\n}\n\n.cal-heatmap-container .hover_cursor:hover {\n  cursor: pointer\n}\n\n.cal-heatmap-container .qi {\n  background-color: #999;\n  fill: #999\n}\n\n/*\nRemove comment to apply this style to date with value equal to 0\n.q0\n{\n  background-color: #fff;\n  fill: #fff;\n  stroke: #ededed\n}\n*/\n\n.cal-heatmap-container .q1\n{\n  background-color: #dae289;\n  fill: #dae289\n}\n\n.cal-heatmap-container .q2\n{\n  background-color: #cedb9c;\n  fill: #9cc069\n}\n\n.cal-heatmap-container .q3\n{\n  background-color: #b5cf6b;\n  fill: #669d45\n}\n\n.cal-heatmap-container .q4\n{\n  background-color: #637939;\n  fill: #637939\n}\n\n.cal-heatmap-container .q5\n{\n  background-color: #3b6427;\n  fill: #3b6427\n}\n\n.cal-heatmap-container rect.highlight\n{\n  stroke:#444;\n  stroke-width:1\n}\n\n.cal-heatmap-container text.highlight\n{\n  fill: #444\n}\n\n.cal-heatmap-container rect.highlight-now\n{\n  stroke: red\n}\n\n.cal-heatmap-container text.highlight-now\n{\n  fill: red;\n  font-weight: 800\n}\n\n.cal-heatmap-container .domain-background {\n  fill: none;\n  shape-rendering: crispedges\n}\n\n.ch-tooltip {\n  padding: 10px;\n  background: #222;\n  color: #bbb;\n  font-size: 12px;\n  line-height: 1.4;\n  width: 140px;\n  position: absolute;\n  z-index: 99999;\n  text-align: center;\n  border-radius: 2px;\n  box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n  display: none;\n  box-sizing: border-box;\n}\n\n.ch-tooltip::after{\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-color: transparent;\n  border-style: solid;\n  content: "";\n  padding: 0;\n  display: block;\n  bottom: -6px;\n  left: 50%;\n  margin-left: -6px;\n    border-width: 6px 6px 0;\n    border-top-color: #222;\n}\n',""])},1049:function(module,exports,__webpack_require__){var content=__webpack_require__(1050);"string"==typeof content&&(content=[[module.i,content,""]]);var options={hmr:!0,transform:void 0,insertInto:void 0};__webpack_require__(147)(content,options);content.locals&&(module.exports=content.locals)},1050:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(146)(!1)).push([module.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n .superset-legacy-chart-calendar {\n  padding: 10px;\n  position: static !important;\n  overflow: auto !important;\n}\n\n.superset-legacy-chart-calendar .ch-tooltip {\n  margin-left: 20px;\n  margin-top: 5px;\n}\n',""])},1051:function(module,exports,__webpack_require__){var content=__webpack_require__(1052);"string"==typeof content&&(content=[[module.i,content,""]]);var options={hmr:!0,transform:void 0,insertInto:void 0};__webpack_require__(147)(content,options);content.locals&&(module.exports=content.locals)},1052:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(146)(!1)).push([module.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* from d3-tip */\n.d3-tip {\n  line-height: 1;\n  padding: 12px;\n  background: rgba(0, 0, 0, 0.8);\n  color: #fff;\n  border-radius: 2px;\n  pointer-events: none;\n  z-index: 1000;\n}\n\n/* Creates a small triangle extender for the tooltip */\n.d3-tip:after {\n  box-sizing: border-box;\n  display: inline;\n  font-size: 10px;\n  width: 100%;\n  line-height: 1;\n  color: rgba(0, 0, 0, 0.8);\n  position: absolute;\n  pointer-events: none;\n}\n\n/* Northward tooltips */\n.d3-tip.n:after {\n  content: "\\25BC";\n  margin: -1px 0 0 0;\n  top: 100%;\n  left: 0;\n  text-align: center;\n}\n\n/* Eastward tooltips */\n.d3-tip.e:after {\n  content: "\\25C0";\n  margin: -4px 0 0 0;\n  top: 50%;\n  left: -8px;\n}\n\n/* Southward tooltips */\n.d3-tip.s:after {\n  content: "\\25B2";\n  margin: 0 0 1px 0;\n  top: -8px;\n  left: 0;\n  text-align: center;\n}\n\n/* Westward tooltips */\n.d3-tip.w:after {\n  content: "\\25B6";\n  margin: -4px 0 0 -1px;\n  top: 50%;\n  left: 100%;\n}\n',""])},1590:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var reactify=__webpack_require__(737),prop_types=__webpack_require__(0),prop_types_default=__webpack_require__.n(prop_types),src=__webpack_require__(20),d3_selection_src=__webpack_require__(86),SequentialSchemeRegistrySingleton=__webpack_require__(186),NumberFormatterRegistrySingleton=__webpack_require__(145),TimeFormatterRegistrySingleton=__webpack_require__(694),d3_tip=__webpack_require__(194),d3=(__webpack_require__(1051),__webpack_require__(54)),CalHeatMap=(d3=__webpack_require__(54),function(){function t(e,t){var o=n.options.cellSize*n._domainType[n.options.subDomain].column(e)+n.options.cellPadding*n._domainType[n.options.subDomain].column(e);return 2===arguments.length&&!0===t?o+=n.domainHorizontalLabelWidth+n.options.domainGutter+n.options.domainMargin[1]+n.options.domainMargin[3]:o}function o(e,t){var o=n.options.cellSize*n._domainType[n.options.subDomain].row(e)+n.options.cellPadding*n._domainType[n.options.subDomain].row(e);return 2===arguments.length&&!0===t&&(o+=n.options.domainGutter+n.domainVerticalLabelHeight+n.options.domainMargin[0]+n.options.domainMargin[2]),o}var n=this;for(var i in n.tip=Object(d3_tip.a)().attr("class","d3-tip").direction("n").offset([-5,0]).html(function(e){return"\n      "+n.options.timeFormatter(e.t)+": <strong>"+n.options.valueFormatter(e.v)+"</strong>\n    "}),n.legendTip=Object(d3_tip.a)().attr("class","d3-tip").direction("n").offset([-5,0]).html(function(e){return n.options.valueFormatter(e)}),this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:function valueFormatter(e){return e},timeFormatter:function timeFormatter(e){return e},domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,dataRequestHeaders:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData:function afterLoadData(e){return e},afterUpdate:null,onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function row(e){return n.getSubDomainRowNumber(e)},column:function column(e){return n.getSubDomainColumnNumber(e)},position:{x:function x(e){return Math.floor(e.getMinutes()/n._domainType.min.row(e))},y:function y(e){return e.getMinutes()%n._domainType.min.row(e)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function extractUnit(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function maxItemNumber(e){switch(n.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(n.options.domainDynamicDimension?n.getDayCountInMonth(e):31)}},defaultRowNumber:6,defaultColumnNumber:function defaultColumnNumber(e){switch(n.options.domain){case"day":return 4;case"week":return 28;case"month":return n.options.domainDynamicDimension?n.getDayCountInMonth(e):31}},row:function row(e){return n.getSubDomainRowNumber(e)},column:function column(e){return n.getSubDomainColumnNumber(e)},position:{x:function x(e){return"month"===n.options.domain?0<n.options.colLimit||0<n.options.rowLimit?Math.floor((e.getHours()+24*(e.getDate()-1))/n._domainType.hour.row(e)):Math.floor(e.getHours()/n._domainType.hour.row(e))+4*(e.getDate()-1):"week"===n.options.domain?0<n.options.colLimit||0<n.options.rowLimit?Math.floor((e.getHours()+24*n.getWeekDay(e))/n._domainType.hour.row(e)):Math.floor(e.getHours()/n._domainType.hour.row(e))+4*n.getWeekDay(e):Math.floor(e.getHours()/n._domainType.hour.row(e))},y:function y(e){var t=e.getHours();if(0<n.options.colLimit||0<n.options.rowLimit)switch(n.options.domain){case"month":t+=24*(e.getDate()-1);break;case"week":t+=24*n.getWeekDay(e)}return Math.floor(t%n._domainType.hour.row(e))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function extractUnit(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function maxItemNumber(e){switch(n.options.domain){case"week":return 7;case"month":return n.options.domainDynamicDimension?n.getDayCountInMonth(e):31;case"year":return n.options.domainDynamicDimension?n.getDayCountInYear(e):366}},defaultColumnNumber:function defaultColumnNumber(e){switch(e=new Date(e),n.options.domain){case"week":return 1;case"month":return n.options.domainDynamicDimension&&!n.options.verticalOrientation?n.getWeekNumber(new Date(e.getFullYear(),e.getMonth()+1,0))-n.getWeekNumber(e)+1:6;case"year":return n.options.domainDynamicDimension?n.getWeekNumber(new Date(e.getFullYear(),11,31))-n.getWeekNumber(new Date(e.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function row(e){return n.getSubDomainRowNumber(e)},column:function column(e){return n.getSubDomainColumnNumber(e)},position:{x:function x(e){switch(n.options.domain){case"week":return Math.floor(n.getWeekDay(e)/n._domainType.day.row(e));case"month":return 0<n.options.colLimit||0<n.options.rowLimit?Math.floor((e.getDate()-1)/n._domainType.day.row(e)):n.getWeekNumber(e)-n.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));case"year":return 0<n.options.colLimit||0<n.options.rowLimit?Math.floor((n.getDayOfYear(e)-1)/n._domainType.day.row(e)):n.getWeekNumber(e)}},y:function y(e){var t=n.getWeekDay(e);if(0<n.options.colLimit||0<n.options.rowLimit)switch(n.options.domain){case"year":t=n.getDayOfYear(e)-1;break;case"week":t=n.getWeekDay(e);break;case"month":t=e.getDate()-1}return Math.floor(t%n._domainType.day.row(e))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function extractUnit(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function defaultColumnNumber(e){switch(e=new Date(e),n.options.domain){case"year":return n._domainType.week.maxItemNumber;case"month":return n.options.domainDynamicDimension?n.getWeekNumber(new Date(e.getFullYear(),e.getMonth()+1,0))-n.getWeekNumber(e):5}},defaultRowNumber:1,row:function row(e){return n.getSubDomainRowNumber(e)},column:function column(e){return n.getSubDomainColumnNumber(e)},position:{x:function x(e){switch(n.options.domain){case"year":return Math.floor(n.getWeekNumber(e)/n._domainType.week.row(e));case"month":return Math.floor(n.getMonthWeekNumber(e)/n._domainType.week.row(e))}},y:function y(e){return n.getWeekNumber(e)%n._domainType.week.row(e)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function extractUnit(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=t.getDay()-(n.options.weekStartOnMonday?1:0);return 0>o&&(o=6),t.setDate(t.getDate()-o),t.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function row(){return n.getSubDomainRowNumber()},column:function column(){return n.getSubDomainColumnNumber()},position:{x:function x(e){return Math.floor(e.getMonth()/n._domainType.month.row(e))},y:function y(e){return e.getMonth()%n._domainType.month.row(e)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function extractUnit(e){return new Date(e.getFullYear(),e.getMonth()).getTime()}},year:{name:"year",level:60,row:function row(){return n.options.rowLimit||1},column:function column(){return n.options.colLimit||1},position:{x:function x(){return 1},y:function y(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function extractUnit(e){return new Date(e.getFullYear()).getTime()}}},this._domainType)if(this._domainType.hasOwnProperty(i)){var a=this._domainType[i];this._domainType["x_"+i]={name:"x_"+i,level:a.type,maxItemNumber:a.maxItemNumber,defaultRowNumber:a.defaultRowNumber,defaultColumnNumber:a.defaultColumnNumber,row:a.column,column:a.row,position:{x:a.position.y,y:a.position.x},format:a.format,extractUnit:a.extractUnit}}this.lastInsertedSvg=null,this._completed=!1,this._domains=d3.map(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new DomainPosition,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return n.getDomain(n.options.start).map(function(e){return e.getTime()}).map(function(e){n._domains.set(e,n.getSubDomain(e).map(function(e){return{t:n._domainType[n.options.subDomain].extractUnit(e),v:null}}))}),n.root=d3.select(n.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),n.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),n.Legend=new Legend(n),n.options.paintOnLoad&&function e(){n.verticalDomainLabel="top"===n.options.label.position||"bottom"===n.options.label.position,n.domainVerticalLabelHeight=null===n.options.label.height?Math.max(25,2*n.options.cellSize):n.options.label.height,n.domainHorizontalLabelWidth=0,""===n.options.domainLabelFormat&&null===n.options.label.height&&(n.domainVerticalLabelHeight=0),n.verticalDomainLabel||(n.domainVerticalLabelHeight=0,n.domainHorizontalLabelWidth=n.options.label.width),n.paint(),!1!==n.options.nextSelector&&d3.select(n.options.nextSelector).on("click."+n.options.itemNamespace,function(){return d3.event.preventDefault(),n.loadNextDomain(1)}),!1!==n.options.previousSelector&&d3.select(n.options.previousSelector).on("click."+n.options.itemNamespace,function(){return d3.event.preventDefault(),n.loadPreviousDomain(1)}),n.Legend.redraw(n.graphDim.width-n.options.domainGutter-n.options.cellPadding),n.afterLoad();var e=n.getDomainKeys();n.options.loadOnInit?n.getDatas(n.options.data,new Date(e[0]),n.getSubDomain(e[e.length-1]).pop(),function(){n.fill(),n.onComplete()}):n.onComplete(),n.checkIfMinDomainIsReached(e[0]),n.checkIfMaxDomainIsReached(n.getNextDomain().getTime())}(),n.root.call(n.tip),n.root.call(n.legendTip),!0},this.paint=function(e){function i(t,o,i,a){var r=0;return!1===e?(r=o[i],o[i]+=a,n.domainPosition.setPosition(t,r),r):e===n.NAVIGATE_RIGHT?(n.domainPosition.setPosition(t,o[i]),d=a,m=n.domainPosition.getPositionFromIndex(1),n.domainPosition.shiftRightBy(m),o[i]):e===n.NAVIGATE_LEFT?(d=-(r=-a),m=o[i]-n.domainPosition.getLast(),n.domainPosition.setPosition(t,r),n.domainPosition.shiftLeftBy(d),r):void 0}var r=n.options;0===arguments.length&&(e=!1);var l=n.root.select(".graph").selectAll(".graph-domain").data(function(){var t=n.getDomainKeys();return e===n.NAVIGATE_LEFT?t.reverse():t},function(e){return e}),d=0,m=0,s=l.enter().append("svg").attr("width",function(e){return t(e,!0)}).attr("height",function(e){return o(e,!0)}).attr("x",function(e){return r.verticalOrientation?(n.graphDim.width=Math.max(n.graphDim.width,t(e,!0)),0):i(e,n.graphDim,"width",t(e,!0))}).attr("y",function(e){return r.verticalOrientation?i(e,n.graphDim,"height",o(e,!0)):(n.graphDim.height=Math.max(n.graphDim.height,o(e,!0)),0)}).attr("class",function(e){var t="graph-domain",o=new Date(e);switch(r.domain){case"hour":t+=" h_"+o.getHours();case"day":t+=" d_"+o.getDate()+" dy_"+o.getDay();case"week":t+=" w_"+n.getWeekNumber(o);case"month":t+=" m_"+(o.getMonth()+1);case"year":t+=" y_"+o.getFullYear()}return t});n.lastInsertedSvg=s,s.append("rect").attr("width",function(e){return t(e,!0)-r.domainGutter-r.cellPadding}).attr("height",function(e){return o(e,!0)-r.domainGutter-r.cellPadding}).attr("class","domain-background");var p=s.append("svg").attr("x",function(){return"left"===r.label.position?n.domainHorizontalLabelWidth+r.domainMargin[3]:r.domainMargin[3]}).attr("y",function(){return"top"===r.label.position?n.domainVerticalLabelHeight+r.domainMargin[0]:r.domainMargin[0]}).attr("class","graph-subdomain-group").selectAll("g").data(function(e){return n._domains.get(e)}).enter().append("g");p.append("rect").attr("class",function(e){return"graph-rect"+n.getHighlightClassName(e.t)+(null===r.onClick?"":" hover_cursor")}).attr("width",r.cellSize).attr("height",r.cellSize).attr("x",function(e){return n.positionSubDomainX(e.t)}).attr("y",function(e){return n.positionSubDomainY(e.t)}).on("click",function(e){if(null!==r.onClick)return n.onClick(new Date(e.t),e.v)}).call(function(e){0<r.cellRadius&&e.attr("rx",r.cellRadius).attr("ry",r.cellRadius),null!==n.legendScale&&null!==r.legendColors&&r.legendColors.hasOwnProperty("base")&&e.attr("fill",r.legendColors.base),r.tooltip&&e.on("mouseover",function(e){n.tip.show(e,this)}).on("mouseout",function(){n.tip.hide(a)})}),r.tooltip||p.append("title").text(function(e){return n.formatDate(new Date(e.t),r.subDomainDateFormat)}),""!==r.domainLabelFormat&&s.append("text").attr("class","graph-label").attr("y",function(e){var t=r.domainMargin[0];switch(r.label.position){case"top":t+=n.domainVerticalLabelHeight/2;break;case"bottom":t+=o(e)+n.domainVerticalLabelHeight/2}return t+r.label.offset.y*("right"===r.label.rotate&&"right"===r.label.position||"left"===r.label.rotate&&"left"===r.label.position?-1:1)}).attr("x",function(e){var o=r.domainMargin[3];switch(r.label.position){case"right":o+=t(e);break;case"bottom":case"top":o+=t(e)/2}return"right"===r.label.align?o+n.domainHorizontalLabelWidth-r.label.offset.x*("right"===r.label.rotate?-1:1):o+r.label.offset.x}).attr("text-anchor",function(){switch(r.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return n.verticalDomainLabel?"middle":"top"}).text(function(e){return n.formatDate(new Date(e),r.domainLabelFormat)}).call(function(e){switch(r.label.rotate){case"right":e.attr("transform",function(e){var o="rotate(90), ";switch(r.label.position){case"right":o+="translate(-"+t(e)+" , -"+t(e)+")";break;case"left":o+="translate(0, -"+n.domainHorizontalLabelWidth+")"}return o});break;case"left":e.attr("transform",function(e){var o="rotate(270), ";switch(r.label.position){case"right":o+="translate(-"+(t(e)+n.domainHorizontalLabelWidth)+" , "+t(e)+")";break;case"left":o+="translate(-"+n.domainHorizontalLabelWidth+" , "+n.domainHorizontalLabelWidth+")"}return o})}}),null!==r.subDomainTextFormat&&p.append("text").attr("class",function(e){return"subdomain-text"+n.getHighlightClassName(e.t)}).attr("x",function(e){return n.positionSubDomainX(e.t)+r.cellSize/2}).attr("y",function(e){return n.positionSubDomainY(e.t)+r.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(e){return n.formatDate(new Date(e.t),r.subDomainTextFormat)}),!1!==e&&l.transition().duration(r.animationDuration).attr("x",function(e){return r.verticalOrientation?0:n.domainPosition.getPosition(e)}).attr("y",function(e){return r.verticalOrientation?n.domainPosition.getPosition(e):0});var u=n.graphDim.width,h=n.graphDim.height;r.verticalOrientation?n.graphDim.height+=d-m:n.graphDim.width+=d-m,l.exit().transition().duration(r.animationDuration).attr("x",function(o){return r.verticalOrientation?0:e===n.NAVIGATE_LEFT?Math.min(n.graphDim.width,u):e===n.NAVIGATE_RIGHT?-t(o,!0):void 0}).attr("y",function(t){if(!r.verticalOrientation)return 0;switch(e){case n.NAVIGATE_LEFT:return Math.min(n.graphDim.height,h);case n.NAVIGATE_RIGHT:return-o(t,!0)}}).remove(),n.resize()}});CalHeatMap.prototype={init:function init(e){function t(e,t,o){if((t&&!1===e||e instanceof Element||"string"==typeof e)&&""!==e)return!0;throw new Error("The "+o+" is not valid")}function o(e){switch("number"==typeof e&&(e=[e]),Array.isArray(e)||(console.log("Margin only takes an integer or an array of integers"),e=[0]),e.length){case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];case 4:return e;default:return e.slice(0,4)}}var n=this,i=n.options=function mergeRecursive(t,o){for(var n in o)try{t[n]=o[n].constructor===Object?mergeRecursive(t[n],o[n]):o[n]}catch(i){t[n]=o[n]}return t}(n.options,e);if(function(){if(!n._domainType.hasOwnProperty(i.domain)||"min"===i.domain||"x_"===i.domain.substring(0,2))throw new Error("The domain '"+i.domain+"' is not valid");if(!n._domainType.hasOwnProperty(i.subDomain)||"year"===i.subDomain)throw new Error("The subDomain '"+i.subDomain+"' is not valid");if(n._domainType[i.domain].level<=n._domainType[i.subDomain].level)throw new Error("'"+i.subDomain+"' is not a valid subDomain to '"+i.domain+"'")}(),t(i.itemSelector,!1,"itemSelector"),-1===n.allowedDataType.indexOf(i.dataType))throw new Error("The data type '"+i.dataType+"' is not valid data type");if(null===d3.select(i.itemSelector)[0][0])throw new Error("The node '"+i.itemSelector+"' specified in itemSelector does not exists");try{t(i.nextSelector,!0,"nextSelector"),t(i.previousSelector,!0,"previousSelector")}catch(e){return console.log(e.message),!1}e.hasOwnProperty("subDomain")||(this.options.subDomain=function(e){return"year"===e?"month":"month"===e?"day":"week"===e?"day":"day"===e?"hour":"min"}(e.domain)),("string"!=typeof i.itemNamespace||""===i.itemNamespace)&&(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),i.itemNamespace="cal-heatmap");var a=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var r in a)e.hasOwnProperty(a[r])&&(i[a[r]]=e[a[r]]);return i.subDomainDateFormat="string"==typeof i.subDomainDateFormat||"function"==typeof i.subDomainDateFormat?i.subDomainDateFormat:this._domainType[i.subDomain].format.date,i.domainLabelFormat="string"==typeof i.domainLabelFormat||"function"==typeof i.domainLabelFormat?i.domainLabelFormat:this._domainType[i.domain].format.legend,i.subDomainTextFormat="string"==typeof i.subDomainTextFormat&&""!==i.subDomainTextFormat||"function"==typeof i.subDomainTextFormat?i.subDomainTextFormat:null,i.domainMargin=o(i.domainMargin),i.legendMargin=o(i.legendMargin),i.highlight=n.expandDateSetting(i.highlight),i.itemName=function(e){return"string"==typeof e?[e,e+(""===e?"":"s")]:Array.isArray(e)?1===e.length?[e[0],e[0]+"s"]:2<e.length?e.slice(0,2):e:["item","items"]}(i.itemName),i.colLimit=function(e){return 0<e?e:null}(i.colLimit),i.rowLimit=function(e){return 0<e&&0<i.colLimit?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):0<e?e:null}(i.rowLimit),e.hasOwnProperty("legendMargin")||function(){switch(i.legendVerticalPosition){case"top":i.legendMargin[2]=n.DEFAULT_LEGEND_MARGIN;break;case"bottom":i.legendMargin[0]=n.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":i.legendMargin["right"===i.legendHorizontalPosition?3:1]=n.DEFAULT_LEGEND_MARGIN}}(),function(){if(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("align")){switch(i.label.position){case"left":i.label.align="right";break;case"right":i.label.align="left";break;default:i.label.align="center"}"left"===i.label.rotate?i.label.align="right":"right"===i.label.rotate&&(i.label.align="left")}e.hasOwnProperty("label")&&(!e.hasOwnProperty("label")||e.label.hasOwnProperty("offset"))||"left"!==i.label.position&&"right"!==i.label.position||(i.label.offset={x:10,y:15})}(),this._init()},expandDateSetting:function expandDateSetting(e){return Array.isArray(e)||(e=[e]),e.map(function(e){return"now"===e?new Date:!!(e instanceof Date)&&e}).filter(function(e){return!1!==e})},fill:function fill(e){var t=this,o=t.options;0===arguments.length&&(e=t.root.selectAll(".graph-domain"));var n=e.selectAll("svg").selectAll("g").data(function(e){return t._domains.get(e)});n.transition().duration(o.animationDuration).select("rect").attr("class",function(e){var n=t.getHighlightClassName(e.t).trim().split(" "),i=t.dateIsLessThan(e.t,new Date),a=t.dateIsEqual(e.t,new Date);return null!==t.legendScale&&(null!==e.v||!o.hasOwnProperty("considerMissingDataAsZero")||o.considerMissingDataAsZero||o.legendColors.hasOwnProperty("base"))||n.push("graph-rect"),a?n.push("now"):!i&&n.push("future"),null===e.v?o.considerMissingDataAsZero&&i&&n.push(t.Legend.getClass(0,null===t.legendScale)):n.push(t.Legend.getClass(e.v,null===t.legendScale)),null!==o.onClick&&n.push("hover_cursor"),n.join(" ")}).call(function(e){return null!==t.legendScale&&void e.attr("fill",function(e){return null===e.v&&o.hasOwnProperty("considerMissingDataAsZero")&&!o.considerMissingDataAsZero&&o.legendColors.hasOwnProperty("base")?o.legendColors.base:null!==o.legendColors&&o.legendColors.hasOwnProperty("empty")&&(0===e.v||null===e.v&&o.hasOwnProperty("considerMissingDataAsZero")&&o.considerMissingDataAsZero)?o.legendColors.empty:0>e.v&&0<o.legend[0]&&null!==o.legendColors&&o.legendColors.hasOwnProperty("overflow")?o.legendColors.overflow:t.legendScale(Math.min(e.v,o.legend[o.legend.length-1]))})}),n.transition().duration(o.animationDuration).select("title").text(function(e){return t.getSubDomainTitle(e)}),n.transition().duration(o.animationDuration).select("text").attr("class",function(e){return"subdomain-text"+t.getHighlightClassName(e.t)}).call(function(e){"function"==typeof o.subDomainTextFormat&&e.text(function(e){return o.subDomainTextFormat(e.t,e.v)})})},formatStringWithObject:function formatStringWithObject(e,t){for(var o in t)if(t.hasOwnProperty(o)){var n=new RegExp("\\{"+o+"\\}","gi");e=e.replace(n,t[o])}return e},triggerEvent:function triggerEvent(e,t,o){return!!(3===arguments.length&&o||null===this.options[e])||("function"==typeof this.options[e]?("function"==typeof t&&(t=t()),this.options[e].apply(this,t)):(console.log("Provided callback for "+e+" is not a function."),!1))},onClick:function onClick(e,t){return this.triggerEvent("onClick",[e,t])},afterLoad:function afterLoad(){return this.triggerEvent("afterLoad")},onComplete:function onComplete(){var e=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,e},afterLoadPreviousDomain:function afterLoadPreviousDomain(e){var t=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var o=t.getSubDomain(e);return[o.shift(),o.pop()]})},afterLoadNextDomain:function afterLoadNextDomain(e){var t=this;return this.triggerEvent("afterLoadNextDomain",function(){var o=t.getSubDomain(e);return[o.shift(),o.pop()]})},onMinDomainReached:function onMinDomainReached(e){return this._minDomainReached=e,this.triggerEvent("onMinDomainReached",[e])},onMaxDomainReached:function onMaxDomainReached(e){return this._maxDomainReached=e,this.triggerEvent("onMaxDomainReached",[e])},checkIfMinDomainIsReached:function checkIfMinDomainIsReached(e,t){this.minDomainIsReached(e)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(t)&&this.onMaxDomainReached(!1)},checkIfMaxDomainIsReached:function checkIfMaxDomainIsReached(e,t){this.maxDomainIsReached(e)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(t)&&this.onMinDomainReached(!1)},afterUpdate:function afterUpdate(){return this.triggerEvent("afterUpdate")},formatNumber:d3.format(",g"),formatDate:function formatDate(e,t){return 2>arguments.length&&(t="title"),"function"==typeof t?t(e):d3.time.format(t)(e)},getSubDomainTitle:function getSubDomainTitle(e){if(null===e.v&&!this.options.considerMissingDataAsZero)return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)});var t=e.v;return null===t&&this.options.considerMissingDataAsZero&&(t=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(t),name:this.options.itemName[1===t?0:1],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})},loadNextDomain:function loadNextDomain(e){if(this._maxDomainReached||0===e)return!1;var t=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),e));return this.afterLoadNextDomain(t.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),t.start),!0},loadPreviousDomain:function loadPreviousDomain(e){if(this._minDomainReached||0===e)return!1;var t=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-e).reverse());return this.afterLoadPreviousDomain(t.start),this.checkIfMinDomainIsReached(t.start,t.end),!0},loadNewDomains:function loadNewDomains(e,t){function o(e){return{t:n._domainType[n.options.subDomain].extractUnit(e),v:null}}for(var n=this,a=e===this.NAVIGATE_LEFT,r=-1,l=t.length,d=this.getDomainKeys();++r<l;){if(a&&this.minDomainIsReached(t[r])){t=t.slice(0,r+1);break}if(!a&&this.maxDomainIsReached(t[r])){t=t.slice(0,r);break}}for(r=0,l=(t=t.slice(-this.options.range)).length;r<l;r++)this._domains.set(t[r].getTime(),this.getSubDomain(t[r]).map(o)),this._domains.remove(a?d.pop():d.shift());return d=this.getDomainKeys(),a&&(t=t.reverse()),this.paint(e),this.getDatas(this.options.data,t[0],this.getSubDomain(t[t.length-1]).pop(),function(){n.fill(n.lastInsertedSvg)}),{start:t[a?0:1],end:d[d.length-1]}},maxDomainIsReached:function maxDomainIsReached(e){return null!==this.options.maxDate&&this.options.maxDate.getTime()<e},minDomainIsReached:function minDomainIsReached(e){return null!==this.options.minDate&&this.options.minDate.getTime()>=e},getDomainKeys:function getDomainKeys(){return this._domains.keys().map(function(e){return parseInt(e,10)}).sort(function(e,t){return e-t})},positionSubDomainX:function positionSubDomainX(e){var t=this._domainType[this.options.subDomain].position.x(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},positionSubDomainY:function positionSubDomainY(e){var t=this._domainType[this.options.subDomain].position.y(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},getSubDomainColumnNumber:function getSubDomainColumnNumber(e){if(0<this.options.rowLimit){var t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.rowLimit)}var o=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof o&&(o=o(e)),this.options.colLimit||o},getSubDomainRowNumber:function getSubDomainRowNumber(e){if(0<this.options.colLimit){var t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.colLimit)}var o=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof o&&(o=o(e)),this.options.rowLimit||o},getHighlightClassName:function getHighlightClassName(e){if(e=new Date(e),0<this.options.highlight.length)for(var t in this.options.highlight)if(this.dateIsEqual(this.options.highlight[t],e))return this.isNow(this.options.highlight[t])?" highlight-now":" highlight";return""},isNow:function isNow(e){return this.dateIsEqual(e,new Date)},dateIsEqual:function dateIsEqual(e,t){switch(e instanceof Date||(e=new Date(e)),t instanceof Date||(t=new Date(t)),this.options.subDomain){case"x_min":case"min":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes();case"x_hour":case"hour":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours();case"x_day":case"day":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();case"x_week":case"week":return e.getFullYear()===t.getFullYear()&&this.getWeekNumber(e)===this.getWeekNumber(t);case"x_month":case"month":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth();default:return!1}},dateIsLessThan:function dateIsLessThan(e,t){function o(e,t){return"x_min"===t||"min"===t?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()).getTime():"x_hour"===t||"hour"===t?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()).getTime():"x_day"===t||"day"===t?new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime():"x_week"===t||"week"===t||"x_month"===t||"month"===t?new Date(e.getFullYear(),e.getMonth()).getTime():e.getTime()}return e instanceof Date||(e=new Date(e)),t instanceof Date||(t=new Date(t)),o(e,this.options.subDomain)<o(t,this.options.subDomain)},getDayOfYear:d3.time.format("%j"),getWeekNumber:function getWeekNumber(e){return(!0===this.options.weekStartOnMonday?d3.time.format("%W"):d3.time.format("%U"))(e)},getMonthWeekNumber:function getMonthWeekNumber(e){"number"==typeof e&&(e=new Date(e));var t=this.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));return this.getWeekNumber(e)-t-1},getWeekNumberInYear:function getWeekNumberInYear(e){"number"==typeof e&&(e=new Date(e))},getDayCountInMonth:function getDayCountInMonth(e){return this.getEndOfMonth(e).getDate()},getDayCountInYear:function getDayCountInYear(e){return"number"==typeof e&&(e=new Date(e)),1===new Date(e.getFullYear(),1,29).getMonth()?366:365},getWeekDay:function getWeekDay(e){return!1===this.options.weekStartOnMonday?e.getDay():0===e.getDay()?6:e.getDay()-1},getEndOfMonth:function getEndOfMonth(e){return"number"==typeof e&&(e=new Date(e)),new Date(e.getFullYear(),e.getMonth()+1,0)},jumpDate:function jumpDate(e,t,o){var n=new Date(e);return"hour"===o?n.setHours(n.getHours()+t):"day"===o?n.setHours(n.getHours()+24*t):"week"===o?n.setHours(n.getHours()+24*t*7):"month"===o?n.setMonth(n.getMonth()+t):"year"===o&&n.setFullYear(n.getFullYear()+t),new Date(n)},getMinuteDomain:function getMinuteDomain(e,t){var n,o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());return n=t instanceof Date?new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()):new Date(+o+1e3*t*60),d3.time.minutes(Math.min(o,n),Math.max(o,n))},getHourDomain:function getHourDomain(e,t){var o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),n=null;t instanceof Date?n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()):(n=new Date(o)).setHours(n.getHours()+t);var a=d3.time.hours(Math.min(o,n),Math.max(o,n)),r=0,l=a.length;for(r=0;r<l;r++)if(0<r&&a[r].getHours()===a[r-1].getHours()){this.DSTDomain.push(a[r].getTime()),a.splice(r,1);break}return"number"==typeof t&&a.length>Math.abs(t)&&a.splice(a.length-1,1),a},getDayDomain:function getDayDomain(e,t){var o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=null;return t instanceof Date?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()):(n=new Date(o),n=new Date(n.setDate(n.getDate()+parseInt(t,10)))),d3.time.days(Math.min(o,n),Math.max(o,n))},getWeekDomain:function getWeekDomain(e,t){var o;!1===this.options.weekStartOnMonday?o=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()):1===e.getDay()?o=new Date(e.getFullYear(),e.getMonth(),e.getDate()):0===e.getDay()?(o=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(o.getDate()-6):o=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+1);var n=new Date(o),i=t;return"object"!=typeof t&&(i=new Date(n.setDate(n.getDate()+7*t))),!0===this.options.weekStartOnMonday?d3.time.mondays(Math.min(o,i),Math.max(o,i)):d3.time.sundays(Math.min(o,i),Math.max(o,i))},getMonthDomain:function getMonthDomain(e,t){var o=new Date(e.getFullYear(),e.getMonth()),n=null;return t instanceof Date?n=new Date(t.getFullYear(),t.getMonth()):n=(n=new Date(o)).setMonth(n.getMonth()+t),d3.time.months(Math.min(o,n),Math.max(o,n))},getYearDomain:function getYearDomain(e,t){var n,o=new Date(e.getFullYear(),0);return n=t instanceof Date?new Date(t.getFullYear(),0):new Date(e.getFullYear()+t,0),d3.time.years(Math.min(o,n),Math.max(o,n))},getDomain:function getDomain(e,t){switch("number"==typeof e&&(e=new Date(e)),2>arguments.length&&(t=this.options.range),this.options.domain){case"hour":var o=this.getHourDomain(e,t);return"number"==typeof t&&o.length<t&&(0<t?o.push(this.getHourDomain(o[o.length-1],2)[1]):o.shift(this.getHourDomain(o[0],-2)[0])),o;case"day":return this.getDayDomain(e,t);case"week":return this.getWeekDomain(e,t);case"month":return this.getMonthDomain(e,t);case"year":return this.getYearDomain(e,t)}},getSubDomain:function getSubDomain(e){"number"==typeof e&&(e=new Date(e));var t=this;switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(e,function(e,t){return"hour"===t?60:"day"===t?1440:"week"===t?10080:void 0}(0,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(e,function(e,o){return"day"===o?24:"week"===o?168:"month"===o?24*t.getDayCountInMonth(e):void 0}(e,this.options.domain));case"x_day":case"day":return this.getDayDomain(e,function(e,o){return"year"===o?t.getDayCountInYear(e):"month"===o?t.getDayCountInMonth(e):"week"===o?7:void 0}(e,this.options.domain));case"x_week":case"week":return this.getWeekDomain(e,function(e,o){if("month"===o){var n=new Date(e.getFullYear(),e.getMonth()+1,0),i=t.getWeekNumber(n),a=t.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));return a>i&&(a=0,i++),i-a+1}return"year"===o?t.getWeekNumber(new Date(e.getFullYear(),11,31)):void 0}(e,this.options.domain));case"x_month":case"month":return this.getMonthDomain(e,12)}},getNextDomain:function getNextDomain(e){return 0===arguments.length&&(e=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),e,this.options.domain),1)[0]},getPreviousDomain:function getPreviousDomain(e){return 0===arguments.length&&(e=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-e,this.options.domain),1)[0]},getDatas:function getDatas(e,t,o,n,i,a){var r=this;5>arguments.length&&(i=!0),6>arguments.length&&(a=this.APPEND_ON_UPDATE);var l=function(e,l){!1===i?("csv"===r.options.dataType||"tsv"===r.options.dataType)&&(l=this.interpretCSV(l)):"function"==typeof i?l=i(l):"function"==typeof r.options.afterLoadData?l=r.options.afterLoadData(l):console.log("Provided callback for afterLoadData is not a function."),r.parseDatas(l,a,t,o),"function"==typeof n&&n()};switch(typeof e){case"string":if(""===e)return l(0,{}),!0;var d=this.parseURI(e,t,o),m="GET";null!==r.options.dataPostPayload&&(m="POST");var s=null;null!==r.options.dataPostPayload&&(s=this.parseURI(r.options.dataPostPayload,t,o));var g=null;switch(this.options.dataType){case"json":g=d3.json(d);break;case"csv":g=d3.csv(d);break;case"tsv":g=d3.tsv(d);break;case"txt":g=d3.text(d,"text/plain")}if(null!==r.options.dataRequestHeaders)for(var p in r.options.dataRequestHeaders)r.options.dataRequestHeaders.hasOwnProperty(p)&&g.header(p,r.options.dataRequestHeaders[p]);return g.send(m,s,l),!1;case"object":if(e===Object(e))return l(0,e),!1;default:return l(0,{}),!0}},parseDatas:function parseDatas(e,t,o,n){t===this.RESET_ALL_ON_UPDATE&&this._domains.forEach(function(e,t){t.forEach(function(e,t,o){o[t].v=null})});var i={},a=function(e){return e.t};for(var r in e){var l=new Date(1e3*r),d=this.getDomain(l)[0].getTime();if(0<=this.DSTDomain.indexOf(d)&&this._domains.has(d-36e5)&&(d-=36e5),!isNaN(r)&&e.hasOwnProperty(r)&&this._domains.has(d)&&d>=+o&&d<+n){var m=this._domains.get(d);i.hasOwnProperty(d)||(i[d]=m.map(a));var s=i[d].indexOf(this._domainType[this.options.subDomain].extractUnit(l));t===this.RESET_SINGLE_ON_UPDATE?m[s].v=e[r]:isNaN(m[s].v)?m[s].v=e[r]:m[s].v+=e[r]}}},parseURI:function parseURI(e,t,o){return e=(e=(e=(e=e.replace(/\{\{t:start\}\}/g,t.getTime()/1e3)).replace(/\{\{t:end\}\}/g,o.getTime()/1e3)).replace(/\{\{d:start\}\}/g,t.toISOString())).replace(/\{\{d:end\}\}/g,o.toISOString())},interpretCSV:function interpretCSV(e){var t,o,n={},a=Object.keys(e[0]);for(t=0,o=e.length;t<o;t++)n[e[t][a[0]]]=+e[t][a[1]];return n},resize:function resize(){var e=this,t=e.options,o=t.displayLegend?e.Legend.getDim("width")+t.legendMargin[1]+t.legendMargin[3]:0,n=t.displayLegend?e.Legend.getDim("height")+t.legendMargin[0]+t.legendMargin[2]:0,i=e.graphDim.width-t.domainGutter-t.cellPadding,a=e.graphDim.height-t.domainGutter-t.cellPadding;this.root.transition().duration(t.animationDuration).attr("width",function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?i+o:Math.max(i,o)}).attr("height",function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?Math.max(a,n):a+n}),this.root.select(".graph").transition().duration(t.animationDuration).attr("y",function(){return"top"===t.legendVerticalPosition?n:0}).attr("x",function(){return"middle"!==t.legendVerticalPosition&&"center"!==t.legendVerticalPosition||"left"!==t.legendHorizontalPosition?0:o})},next:function next(e){return 0===arguments.length&&(e=1),this.loadNextDomain(e)},previous:function previous(e){return 0===arguments.length&&(e=1),this.loadPreviousDomain(e)},jumpTo:function jumpTo(e,t){2>arguments.length&&(t=!1);var o=this.getDomainKeys(),n=o[0],i=o[o.length-1];return e<n?this.loadPreviousDomain(this.getDomain(n,e).length):t?this.loadNextDomain(this.getDomain(n,e).length):!!(e>i)&&this.loadNextDomain(this.getDomain(i,e).length)},rewind:function rewind(){this.jumpTo(this.options.start,!0)},update:function update(e,t,o){0===arguments.length&&(e=this.options.data),2>arguments.length&&(t=!0),3>arguments.length&&(o=this.RESET_ALL_ON_UPDATE);var n=this.getDomainKeys(),i=this;this.getDatas(e,new Date(n[0]),this.getSubDomain(n[n.length-1]).pop(),function(){i.fill(),i.afterUpdate()},t,o)},setLegend:function setLegend(){var e=this.options.legend.slice(0);1<=arguments.length&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),2<=arguments.length&&(Array.isArray(arguments[1])&&2<=arguments[1].length?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(0<arguments.length&&!function arrayEquals(e,t){if(!t||!e)return!1;if(e.length!==t.length)return!1;for(var o=0;o<e.length;o++)if(e[o]instanceof Array&&t[o]instanceof Array){if(!arrayEquals(e[o],t[o]))return!1}else if(e[o]!==t[o])return!1;return!0}(e,this.options.legend)||2<=arguments.length)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function removeLegend(){return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)},showLegend:function showLegend(){return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)},highlight:function highlight(e){return!!(0<(this.options.highlight=this.expandDateSetting(e)).length)&&(this.fill(),!0)},destroy:function destroy(e){return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){"function"==typeof e?e():void 0!==e&&console.log("Provided callback for destroy() is not a function.")}),null},getSVG:function getSVG(){for(var e={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},t=1,o=this.options.legend.length+1;t<=o;t++)e[".q"+t]={};var n=this.root,a=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],r=function(t,o,n){-1!==a.indexOf(o)&&(e[t][o]=n)},d=function(t){return n.select(t)[0][0]};for(var m in e)if(e.hasOwnProperty(m)){var s=d(m);if(null!==s)if("getComputedStyle"in window){var g=getComputedStyle(s,null);if(0!==g.length)for(var u=0;u<g.length;u++)r(m,g.item(u),g.getPropertyValue(g.item(u)));else for(var h in g)g.hasOwnProperty(h)&&r(m,h,g[h])}else if("currentStyle"in s){var c=s.currentStyle;for(var D in c)r(m,D,c[D])}}var p='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var f in e){for(var y in p+=f+" {\n",e[f])p+="\t"+y+":"+e[f][y]+";\n";p+="}\n"}return p+="]]></style>",p+=(new XMLSerializer).serializeToString(this.root[0][0]),p+="</svg>"}};var DomainPosition=function(){this.positions=d3.map()};DomainPosition.prototype.getPosition=function(e){return this.positions.get(e)},DomainPosition.prototype.getPositionFromIndex=function(e){var t=this.getKeys();return this.positions.get(t[e])},DomainPosition.prototype.getLast=function(){var e=this.getKeys();return this.positions.get(e[e.length-1])},DomainPosition.prototype.setPosition=function(e,t){this.positions.set(e,t)},DomainPosition.prototype.shiftRightBy=function(e){this.positions.forEach(function(t,o){this.set(t,o-e)});var t=this.getKeys();this.positions.remove(t[0])},DomainPosition.prototype.shiftLeftBy=function(e){this.positions.forEach(function(t,o){this.set(t,o+e)});var t=this.getKeys();this.positions.remove(t[t.length-1])},DomainPosition.prototype.getKeys=function(){return this.positions.keys().sort(function(e,t){return parseInt(e,10)-parseInt(t,10)})};var Legend=function(e){this.calendar=e,this.computeDim(),null!==e.options.legendColors&&this.buildColors()};Legend.prototype.computeDim=function(){var e=this.calendar.options;this.dim={width:e.legendCellSize*(e.legend.length+1)+e.legendCellPadding*e.legend.length,height:e.legendCellSize}},Legend.prototype.remove=function(){this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()},Legend.prototype.redraw=function(e){function t(e){e.attr("width",m.legendCellSize).attr("height",m.legendCellSize).attr("rx",m.legendCellRadius).attr("ry",m.legendCellRadius).attr("x",function(e,t){return t*(m.legendCellSize+m.legendCellPadding)})}function o(){switch(m.legendHorizontalPosition){case"right":return"center"===m.legendVerticalPosition||"middle"===m.legendVerticalPosition?e+m.legendMargin[3]:e-a.getDim("width")-m.legendMargin[1];case"middle":case"center":return Math.round(e/2-a.getDim("width")/2);default:return m.legendMargin[3]}}function n(){return"bottom"===m.legendVerticalPosition?r.graphDim.height+m.legendMargin[0]-m.domainGutter-m.cellPadding:m.legendMargin[0]}if(!this.calendar.options.displayLegend)return!1;var i,a=this,r=this.calendar,l=r.root,m=r.options;this.computeDim();var s=m.legend.slice(0);s.push(s[s.length-1]+1);var g=r.root.select(".graph-legend");null===g[0][0]?((l="top"===m.legendVerticalPosition?l.insert("svg",".graph"):l.append("svg")).attr("x",o()).attr("y",n()),i=l.attr("class","graph-legend").attr("height",a.getDim("height")).attr("width",a.getDim("width")).append("g").selectAll().data(s)):i=(l=g).select("g").selectAll("rect").data(s),i.enter().append("rect").call(t).attr("class",function(e){return r.Legend.getClass(e,null===r.legendScale)}).attr("fill-opacity",0).call(function(e){null!==r.legendScale&&null!==m.legendColors&&m.legendColors.hasOwnProperty("base")&&e.attr("fill",m.legendColors.base)}).append("title"),i.exit().transition().duration(m.animationDuration).attr("fill-opacity",0).remove(),i.transition().delay(function(e,t){return m.animationDuration*t/10}).call(t).attr("fill-opacity",1).call(function(e){e.attr("fill",function(e,t){return null===r.legendScale?"":0===t?r.legendScale(e-1):r.legendScale(m.legend[t-1])}),e.attr("class",function(e){return r.Legend.getClass(e,null===r.legendScale)})}),i.select("title").text(function(e,t){return 0===t?r.formatStringWithObject(m.legendTitleFormat.lower,{min:m.legend[t],name:m.itemName[1]}):t===s.length-1?r.formatStringWithObject(m.legendTitleFormat.upper,{max:m.legend[t-1],name:m.itemName[1]}):r.formatStringWithObject(m.legendTitleFormat.inner,{down:m.legend[t-1],up:m.legend[t],name:m.itemName[1]})}),i.on("mouseover",function(e){r.legendTip.show(e,this)}).on("mouseout",function(){r.legendTip.hide()}),l.transition().duration(m.animationDuration).attr("x",o()).attr("y",n()).attr("width",a.getDim("width")).attr("height",a.getDim("height")),l.select("g").transition().duration(m.animationDuration).attr("transform",function(){return"vertical"===m.legendOrientation?"rotate(90 "+m.legendCellSize/2+" "+m.legendCellSize/2+")":""}),r.resize()},Legend.prototype.getDim=function(e){var t="horizontal"===this.calendar.options.legendOrientation;return"width"===e?this.dim[t?"width":"height"]:"height"===e?this.dim[t?"height":"width"]:void 0},Legend.prototype.buildColors=function(){var e=this.calendar.options;if(null===e.legendColors)return this.calendar.legendScale=null,!1;var t=[];if(Array.isArray(e.legendColors))t=e.legendColors;else{if(!e.legendColors.hasOwnProperty("min")||!e.legendColors.hasOwnProperty("max"))return e.legendColors=null,!1;t=[e.legendColors.min,e.legendColors.max]}var o=e.legend.slice(0);0<o[0]?o.unshift(0):0>=o[0]&&o.unshift(o[0]-(o[o.length-1]-o[0])/o.length);var n=e.legendColors.hasOwnProperty("colorScale")?e.legendColors.colorScale:d3.scale.linear().range(t).interpolate(d3.interpolateHcl).domain([d3.min(o),d3.max(o)]),i=o.map(function(e){return n(e)});return this.calendar.legendScale=d3.scale.threshold().domain(e.legend).range(i),!0},Legend.prototype.getClass=function(e,t){if(null===e||isNaN(e))return"";for(var o=[this.calendar.options.legend.length+1],n=0,a=this.calendar.options.legend.length-1;n<=a;n++){if(0<this.calendar.options.legend[0]&&0>e){o=["1","i"];break}if(e<=this.calendar.options.legend[n]){o=[n+1];break}}return 0===e&&o.push(0),o.unshift(""),(o.join(" r")+(t?o.join(" q"):"")).trim()};var cal_heatmap=CalHeatMap;__webpack_require__(1047),__webpack_require__(1049);var convertUTCTS=function(a){return function convertUTC(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}(new Date(a)).getTime()},propTypes={data:prop_types_default.a.shape({data:prop_types_default.a.object,domain:prop_types_default.a.string,range:prop_types_default.a.number,start:prop_types_default.a.number,subdomain:prop_types_default.a.string}),height:prop_types_default.a.number,cellPadding:prop_types_default.a.number,cellRadius:prop_types_default.a.number,cellSize:prop_types_default.a.number,linearColorScheme:prop_types_default.a.string,showLegend:prop_types_default.a.bool,showMetricName:prop_types_default.a.bool,showValues:prop_types_default.a.bool,steps:prop_types_default.a.number,timeFormat:prop_types_default.a.string,valueFormat:prop_types_default.a.string,verboseMap:prop_types_default.a.object};function Calendar_Calendar(a,b){var c=b.data,d=b.height,e=b.cellPadding,f=void 0===e?3:e,g=b.cellRadius,h=void 0===g?0:g,i=b.cellSize,j=void 0===i?10:i,k=b.linearColorScheme,l=b.showLegend,m=b.showMetricName,n=b.showValues,o=b.steps,p=b.timeFormat,q=b.valueFormat,r=b.verboseMap,s=Object(NumberFormatterRegistrySingleton.b)(q),t=Object(TimeFormatterRegistrySingleton.b)(p),u=Object(d3_selection_src.select)(a).classed("superset-legacy-chart-calendar",!0).style("height",d);u.selectAll("*").remove();var v=u.append("div"),w=n?function(a,b){return s(b)}:null,x={};Object.keys(c.data).forEach(function(a){x[a]={},Object.keys(c.data[a]).forEach(function(b){x[a][convertUTCTS(1e3*b)/1e3]=c.data[a][b]})}),Object.keys(x).forEach(function(a){var b=v.append("div");m&&b.text("Metric: "+(r[a]||a));var d=x[a],e=Object(src.d)(Object.keys(d),function(a){return d[a]}),g=(e[1]-e[0])/(o-1),i=Object(SequentialSchemeRegistrySingleton.a)().get(k).createLinearScale(e),n=Object(src.f)(o).map(function(a){return e[0]+g*a}),p=n.map(i);(new cal_heatmap).init({start:convertUTCTS(c.start),data:d,itemSelector:b.node(),legendVerticalPosition:"top",cellSize:j,cellPadding:f,cellRadius:h,legendCellSize:j,legendCellPadding:2,legendCellRadius:h,tooltip:!0,domain:c.domain,subDomain:c.subdomain,range:c.range,browsing:!0,legend:n,legendColors:{colorScale:i,min:p[0],max:p[p.length-1],empty:"white"},displayLegend:l,itemName:"",valueFormatter:s,timeFormatter:t,subDomainTextFormat:w})})}Calendar_Calendar.displayName="Calendar",Calendar_Calendar.propTypes=propTypes;var esm_Calendar=Calendar_Calendar;__webpack_exports__.default=Object(reactify.a)(esm_Calendar)},737:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return reactify});var prop_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),prop_types__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);function _extends(){return(_extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c])Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a}).apply(this,arguments)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function reactify(a,b){var c=function(c){function d(a){var b;return _defineProperty(_assertThisInitialized(b=c.call(this,a)||this),"container",void 0),b.setContainerRef=b.setContainerRef.bind(_assertThisInitialized(b)),b}!function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}(d,c);var e=d.prototype;return e.componentDidMount=function componentDidMount(){this.execute()},e.componentDidUpdate=function componentDidUpdate(){this.execute()},e.componentWillUnmount=function componentWillUnmount(){this.container=void 0,b&&b.componentWillUnmount&&b.componentWillUnmount()},e.setContainerRef=function setContainerRef(a){this.container=a},e.execute=function execute(){this.container&&a(this.container,this.props)},e.render=function render(){var a=this.props,b=a.id,c=a.className;return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{id:b,className:c,ref:this.setContainerRef})},d}(react__WEBPACK_IMPORTED_MODULE_1___default.a.Component);_defineProperty(c,"propTypes",{id:prop_types__WEBPACK_IMPORTED_MODULE_0___default.a.string,className:prop_types__WEBPACK_IMPORTED_MODULE_0___default.a.string});var d=c;return a.displayName&&(d.displayName=a.displayName),a.propTypes&&(d.propTypes=_extends({},d.propTypes,a.propTypes)),a.defaultProps&&(d.defaultProps=a.defaultProps),c}}}]);
//# sourceMappingURL=20.8c439e1a5852475f2c9f.bundle.js.map